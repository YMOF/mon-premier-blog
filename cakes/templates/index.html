

{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Yass.cake{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'cakes/css/stylecss.css' %}">
    <style>
        /* ... (Je garde tes styles identiques) ... */
        body { background-color: #FFEAF1; font-family: 'Arial', sans-serif; margin: 0; padding: 0; color: #222; }
        header { text-align: center; padding: 30px 10px; }
        header h1 { color: #CA3C66; }
        .btn_c { display: inline-block; background-color: #e57373; color: mintcream; text-decoration: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; }
main {
    display: flex; /* Active le mode Flexbox */
    flex-wrap: wrap; /* Permet aux cartes de passer à la ligne */
    justify-content: flex-start; /* Aligne les cartes à gauche */
    gap: 20px; /* Espace entre les cartes */
    padding: 30px;
    max-width: 1300px; /* Largeur max pour contenir exactement 4 cartes */
    margin: 0 auto; /* Centre la grille entière sur la page */
}

.card {
    background: pink;
    padding: 20px;
    border-radius: 15px;
    /* Calcul pour 4 colonnes : (100% / 4) - gap */
    width: calc(25% - 20px);
    min-width: 250px; /* Sécurité pour que les cartes ne soient pas trop fines */
    box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    align-items: center;
    box-sizing: border-box; /* Important pour que le padding ne fausse pas le calcul */
}        .card .btn { display: inline-block; margin-top: 10px; padding: 8px 15px; background-color: #CA3C66; color: white; text-decoration: none; border-radius: 20px; }
        .ingredients-container ul { list-style-type: pink; padding-left: 20px; }
        /* Version mobile : 1 seule colonne sur petit écran */
@media (max-width: 768px) {
    .card {
        width: calc(100% - 20px);
    }
}
    </style>
</head>
<body>

<header>
    <h1>Bienvenue chez Yass.cake !</h1>
    <p>Vous aimez la gourmandise et le réconfort ? Alors partagez votre recette préférée</p>
</header>

<main>
    <a href="{% url 'creation_recette' %}" class="btn_c">Créer une recette</a>
    <form method="GET" action="{% url 'accueil' %}" style="width:100%; max-width:600px; margin:0 auto 30px auto;">
        <input type="text" name="q" placeholder="Rechercher une recette..." value="{{ query|default:'' }}">
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button type="submit" class="btn_c" style="flex:1; border:none;">Rechercher</button>
            <button type="submit" name="gen" value="1" class="btn_c" style="flex:1; background-color:#CA3C66; border:none;">Générer recette</button>
        </div>
    </form>

    {% block content %}
    {% if resultat_ollama %}
    <div class="card" style="background-color:#fff3e0; width: 80%; border:1px solid #f5cda5;">
        <h3>Recette générée par IA</h3>
        <p>{{ resultat_ollama|linebreaks }}</p>
    </div>
    {% endif %}

    {% for recette in cakes_recette %}
    <div class="card" id="recipe-{{ recette.id }}">
        <h3>{{ recette.nom }}</h3>

        <div class="ingredients-container" id="ing-container-{{ recette.id }}"></div>

        <button class="btn btn-voir-ing" data-id="{{ recette.id }}" style="border:none; cursor:pointer;">
            Voir les ingrédients
        </button>

        <p><strong>Instructions :</strong><br>{{ recette.instructions|truncatewords:20 }}</p>
        <div style="display: flex; gap: 5px;">
            <a href="{% url 'modifier_recette' recette.id %}" class="btn">Modifier</a>
        </div>
    </div>
    {% empty %}
    <p>Aucune recette disponible pour le moment.</p>
    {% endfor %}
    {% endblock %}
</main>

    <script>
    document.addEventListener('DOMContentLoaded', function() { // On attend que la page soit prête
        document.querySelectorAll('.btn-voir-ing').forEach(button => {
            button.addEventListener('click', function() {
                const recetteId = this.getAttribute('data-id');
                const container = document.getElementById(`ing-container-${recetteId}`);
                const monBouton = this;

                fetch(`/api/ingredients/${recetteId}/`)
                    .then(response => response.json())
                    .then(data => {
                        const titre = document.createElement("strong");
                        titre.textContent = "Ingrédients :";

                        const listeUl = document.createElement("ul");
                        data.ingredients.forEach(nom => {
                            const li = document.createElement("li");
                            li.textContent = nom;
                            listeUl.appendChild(li);
                        });

                        container.appendChild(titre);
                        container.appendChild(listeUl);
                        monBouton.remove();
                    })
                    .catch(error => console.error('Erreur:', error));
            });
        });
    });
    </script>
</body>
</html>
</body>
</html>